<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Volleyball Intro Control Panel</title>
<style>
body { font-family:'Inter',sans-serif; background:#0f172a; color:#f8fafc; padding:30px; }
h1 { color:#3b82f6; margin-bottom:20px; text-align:center; }
.panel { max-width:900px; margin:auto; background:#1e293b; padding:20px; border-radius:12px; }
.github-config { background:#334155; padding:15px; border-radius:8px; margin-bottom:20px; }
.match { border:1px solid #334155; padding:15px; border-radius:10px; margin-bottom:15px; background:#1e293b; }
label { display:block; margin-top:10px; font-weight:600; font-size:14px; }
select,input { width:100%; padding:8px; margin-top:5px; border-radius:6px; border:none; background:#334155; color:#fff; }
input:focus, select:focus { outline: 2px solid #3b82f6; }
button { margin-top:10px; padding:10px 20px; border:none; border-radius:8px; background:#3b82f6; color:white; font-weight:600; cursor:pointer; transition:all 0.3s; }
button:hover { background:#2563eb; transform:translateY(-2px); }
button:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
.btn-success { background:#10b981; }
.btn-success:hover { background:#059669; }
.btn-warning { background:#f59e0b; }
.btn-warning:hover { background:#d97706; }
.match-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
.match-header h3 { color:#3b82f6; margin:0; }
.remove-match-btn { background:#ef4444; padding:5px 10px; margin:0; font-size:12px; }
.remove-match-btn:hover { background:#dc2626; }
.team-row { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px; }
.team-section { background:#334155; padding:12px; border-radius:6px; }
.team-section h4 { margin:0 0 10px 0; font-size:14px; color:#94a3b8; }
.status { margin-top:15px; padding:12px; border-radius:6px; font-weight:500; }
.status.info { background:#1e40af; color:#93c5fd; }
.status.success { background:#166534; color:#86efac; }
.status.error { background:#991b1b; color:#fca5a5; }
.action-buttons { display:flex; gap:10px; margin-top:20px; flex-wrap:wrap; }
.action-buttons button { flex:1; min-width:150px; }
.help-text { font-size:12px; color:#94a3b8; margin-top:5px; }
.spinner { display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,0.3); border-top:2px solid white; border-radius:50%; animation:spin 1s linear infinite; margin-left:8px; }
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
.configured { border:2px solid #10b981; }
</style>
</head>
<body>

<h1>ğŸ Volleyball Intro Control Panel</h1>

<div class="panel">
  <div class="github-config" id="githubConfig">
    <h3>âš™ï¸ GitHub Configuration</h3>
    <label>GitHub Username</label>
    <input type="text" id="githubUsername" placeholder="volleyleaguecupgr">
    
    <label>Repository Name</label>
    <input type="text" id="githubRepo" placeholder="intro">
    
    <label>Personal Access Token</label>
    <input type="password" id="githubToken" placeholder="ghp_xxxxx">
    <div class="help-text">Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ repo access - <a href="https://github.com/settings/tokens/new?scopes=repo" target="_blank" style="color:#3b82f6;">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± token</a></div>
    
    <label>Branch</label>
    <input type="text" id="branch" value="main">
    
    <button id="saveConfig" class="btn-success">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î¡Ï…Î¸Î¼Î¯ÏƒÎµÏ‰Î½</button>
  </div>

  <h2 style="color:#3b82f6; margin-bottom:15px;">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î‘Î³ÏÎ½Ï‰Î½</h2>

  <div id="matchesContainer"></div>

  <div class="action-buttons">
    <button id="addMatch" class="btn-success">+ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î‘Î³ÏÎ½Î±</button>
    <button id="uploadAll" class="btn-primary">ğŸš€ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎŒÎ»Ï‰Î½ ÏƒÏ„Î¿ GitHub</button>
    <button id="previewAll" class="btn-warning">ğŸ‘ï¸ Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· ÎŒÎ»Ï‰Î½</button>
  </div>

  <div id="status" class="status info">Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î±Î³ÏÎ½ÎµÏ‚ ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏƒÏ„Îµ ÏƒÏ„Î¿ GitHub</div>
</div>

<script>
// Default teams
const teams = [
  { name: "Î Î±Î½Î±Î¸Î·Î½Î±ÏŠÎºÏŒÏ‚", slug: "panathinaikos", subtitle: "Î‘.ÎŸ.", color: "#007A33", logo: "panathinaikos.png" },
  { name: "ÎŸÎ»Ï…Î¼Ï€Î¹Î±ÎºÏŒÏ‚", slug: "olympiakos", subtitle: "Î£.Î¦.Î  ÎŸÎÎ•Î§", color: "#E41E26", logo: "olympiakos.png" },
  { name: "Î .Î‘.ÎŸ.Îš.", slug: "paok", subtitle: "Î‘.Î£.", color: "#000000", logo: "paok.png" },
  { name: "ÎšÎ±Î»Î±Î¼Î¬Ï„Î±", slug: "kalamata", subtitle: "A.O. '80 AFFIDEA", color: "#008428", logo: "kalamata.png" },
  { name: "Î¦Î»Î¿Î¯ÏƒÎ²Î¿Ï‚", slug: "floisvos", subtitle: "A. O. MEMBERS PARON", color: "#3a55a8", logo: "floisvos.png" },
  { name: "Î¦Î¿Î¯Î½Î¹ÎºÎ±Ï‚ Î£ÏÏÎ¿Ï…", slug: "foinikas", subtitle: "A.O.", color: "#003399", logo: "foinikas.png" },
  { name: "ÎšÎ·Ï†Î¹ÏƒÎ¹Î¬", slug: "kifisia", subtitle: "A.ÎŸ.Î .Î£.", color: "#1e3a8a", logo: "kifisia.png" },
  { name: "ÎœÎ¯Î»Ï‰Î½", slug: "milon", subtitle: "Î‘.ÎŸ.Î.Î£", color: "#006400", logo: "milon.png" },
  { name: "ÎŸ.Î¦.Î—.", slug: "ofi", subtitle: ".", color: "#000000", logo: "ofi.png" },
  { name: "Î Î±Î½Î¹ÏÎ½Î¹Î¿Ï‚", slug: "panionios", subtitle: "Î“.Î£.Î£.", color: "#004b8d", logo: "panionios.png" }
];

let matches = [];
let githubConfig = null;

function $id(id){ return document.getElementById(id); }

// Load config from localStorage
function loadConfig(){
  const saved = localStorage.getItem('introGithubConfig');
  if(saved){
    githubConfig = JSON.parse(saved);
    $id('githubUsername').value = githubConfig.username;
    $id('githubRepo').value = githubConfig.repo;
    $id('githubToken').value = githubConfig.token;
    $id('branch').value = githubConfig.branch || 'main';
    $id('githubConfig').classList.add('configured');
  }
}

// Save config
$id('saveConfig').addEventListener('click', ()=>{
  const username = $id('githubUsername').value.trim();
  const repo = $id('githubRepo').value.trim();
  const token = $id('githubToken').value.trim();
  const branch = $id('branch').value.trim() || 'main';
  
  if(!username || !repo || !token){
    showStatus('error', 'Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î±!');
    return;
  }
  
  githubConfig = {username, repo, token, branch};
  localStorage.setItem('introGithubConfig', JSON.stringify(githubConfig));
  $id('githubConfig').classList.add('configured');
  showStatus('success', 'âœ… Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½!');
});

// Create match UI
function createMatch(index){
  const matchDiv = document.createElement('div');
  matchDiv.className = 'match';
  matchDiv.dataset.index = index;
  
  matchDiv.innerHTML = `
    <div class="match-header">
      <h3>Î‘Î³ÏÎ½Î±Ï‚ ${index + 1}</h3>
      <button class="remove-match-btn">ğŸ—‘ï¸ Î‘Ï†Î±Î¯ÏÎµÏƒÎ·</button>
    </div>
    
    <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î‘Î³ÏÎ½Î±</label>
    <input type="date" class="matchDate" value="${new Date().toISOString().split('T')[0]}">
    
    <label>Î‘Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ®</label>
    <input type="text" class="league" value="Î· Î‘Î“Î©ÎÎ™Î£Î¤Î™ÎšÎ—">
    
    <div class="team-row">
      <div class="team-section">
        <h4>ğŸ  Î“Î·Ï€ÎµÎ´Î¿ÏÏ‡Î¿Ï‚</h4>
        <label>ÎŸÎ¼Î¬Î´Î±</label>
        <select class="homeTeam">
          <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¿Î¼Î¬Î´Î±...</option>
          ${teams.map(t=>`<option value="${t.slug}">${t.name}</option>`).join('')}
        </select>
        <label>Î¥Ï€ÏŒÏ„Î¹Ï„Î»Î¿Ï‚ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
        <input type="text" class="homeSubtitle" placeholder="Î‘Ï†Î®ÏƒÏ„Îµ ÎºÎµÎ½ÏŒ Î³Î¹Î± Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®">
      </div>
      
      <div class="team-section">
        <h4>âœˆï¸ Î¦Î¹Î»Î¿Î¾ÎµÎ½Î¿ÏÎ¼ÎµÎ½Î¿Ï‚</h4>
        <label>ÎŸÎ¼Î¬Î´Î±</label>
        <select class="awayTeam">
          <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¿Î¼Î¬Î´Î±...</option>
          ${teams.map(t=>`<option value="${t.slug}">${t.name}</option>`).join('')}
        </select>
        <label>Î¥Ï€ÏŒÏ„Î¹Ï„Î»Î¿Ï‚ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
        <input type="text" class="awaySubtitle" placeholder="Î‘Ï†Î®ÏƒÏ„Îµ ÎºÎµÎ½ÏŒ Î³Î¹Î± Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®">
      </div>
    </div>
  `;
  
  $id('matchesContainer').appendChild(matchDiv);
  
  matches.push({
    date: new Date().toISOString().split('T')[0],
    league: 'Î· Î‘Î“Î©ÎÎ™Î£Î¤Î™ÎšÎ—',
    homeTeam: '',
    awayTeam: '',
    homeSubtitle: '',
    awaySubtitle: ''
  });
  
  // Event listeners
  matchDiv.querySelector('.matchDate').addEventListener('change', (e)=>{
    matches[index].date = e.target.value;
  });
  matchDiv.querySelector('.league').addEventListener('input', (e)=>{
    matches[index].league = e.target.value;
  });
  matchDiv.querySelector('.homeTeam').addEventListener('change', (e)=>{
    matches[index].homeTeam = e.target.value;
  });
  matchDiv.querySelector('.awayTeam').addEventListener('change', (e)=>{
    matches[index].awayTeam = e.target.value;
  });
  matchDiv.querySelector('.homeSubtitle').addEventListener('input', (e)=>{
    matches[index].homeSubtitle = e.target.value;
  });
  matchDiv.querySelector('.awaySubtitle').addEventListener('input', (e)=>{
    matches[index].awaySubtitle = e.target.value;
  });
  matchDiv.querySelector('.remove-match-btn').addEventListener('click', ()=>{
    removeMatch(index, matchDiv);
  });
}

function removeMatch(index, matchDiv){
  matches.splice(index, 1);
  matchDiv.remove();
  // Reindex remaining matches
  document.querySelectorAll('.match').forEach((div, i)=>{
    div.dataset.index = i;
    div.querySelector('h3').textContent = `Î‘Î³ÏÎ½Î±Ï‚ ${i + 1}`;
  });
}

// Add match button
$id('addMatch').addEventListener('click', ()=>{
  if(matches.length >= 5){
    showStatus('error', 'ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Î¼Î­Ï‡ÏÎ¹ 5 Î±Î³ÏÎ½ÎµÏ‚!');
    return;
  }
  createMatch(matches.length);
});

// Upload all matches to GitHub
$id('uploadAll').addEventListener('click', async ()=>{
  if(!githubConfig){
    showStatus('error', 'Î Î±ÏÎ±ÎºÎ±Î»Ï ÏÏ…Î¸Î¼Î¯ÏƒÏ„Îµ Ï„Î¿ GitHub Ï€ÏÏÏ„Î±!');
    return;
  }
  
  if(matches.length === 0){
    showStatus('error', 'Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î­Î½Î±Î½ Î±Î³ÏÎ½Î±!');
    return;
  }
  
  // Validate all matches
  for(let i = 0; i < matches.length; i++){
    const m = matches[i];
    if(!m.homeTeam || !m.awayTeam){
      showStatus('error', `Î‘Î³ÏÎ½Î±Ï‚ ${i+1}: Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î´ÏÎ¿ Î¿Î¼Î¬Î´ÎµÏ‚!`);
      return;
    }
    if(m.homeTeam === m.awayTeam){
      showStatus('error', `Î‘Î³ÏÎ½Î±Ï‚ ${i+1}: ÎŸÎ¹ Î¿Î¼Î¬Î´ÎµÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚!`);
      return;
    }
  }
  
  const btn = $id('uploadAll');
  btn.disabled = true;
  btn.innerHTML = 'â³ Î‘Î½Î­Î²Î±ÏƒÎ¼Î±...<span class="spinner"></span>';
  showStatus('info', 'â³ Î“Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÏ„Î¿ GitHub...');
  
  try {
    await uploadAllToGitHub();
    showStatus('success', 'âœ… ÎŒÎ»Î¿Î¹ Î¿Î¹ Î±Î³ÏÎ½ÎµÏ‚ Î±Î½Î­Î²Î·ÎºÎ±Î½ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!');
    btn.disabled = false;
    btn.innerHTML = 'ğŸš€ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎŒÎ»Ï‰Î½ ÏƒÏ„Î¿ GitHub';
  } catch(err){
    console.error('Upload error:', err);
    showStatus('error', `âŒ Î£Ï†Î¬Î»Î¼Î±: ${err.message}`);
    btn.disabled = false;
    btn.innerHTML = 'ğŸš€ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎŒÎ»Ï‰Î½ ÏƒÏ„Î¿ GitHub';
  }
});

// Upload function
async function uploadAllToGitHub(){
  const {username, repo, token, branch} = githubConfig;
  
  // Get current branch info
  const branchInfo = await ghGet(`repos/${username}/${repo}/git/ref/heads/${branch}`, token);
  const latestCommitSha = branchInfo.object.sha;
  const commitInfo = await ghGet(`repos/${username}/${repo}/git/commits/${latestCommitSha}`, token);
  const baseTreeSha = commitInfo.tree.sha;
  
  // Create blobs for all team JSON files
  const tree = [];
  const processedTeams = new Set();
  
  for(const match of matches){
    const homeTeam = teams.find(t => t.slug === match.homeTeam);
    const awayTeam = teams.find(t => t.slug === match.awayTeam);
    
    const matchData = {
      homeTeam: {
        name: homeTeam.name,
        subtitle: match.homeSubtitle || homeTeam.subtitle,
        slug: homeTeam.slug,
        color: homeTeam.color,
        logo: homeTeam.logo
      },
      awayTeam: {
        name: awayTeam.name,
        subtitle: match.awaySubtitle || awayTeam.subtitle,
        slug: awayTeam.slug,
        color: awayTeam.color,
        logo: awayTeam.logo
      },
      date: formatGreekDate(new Date(match.date)),
      league: match.league
    };
    
    const jsonContent = JSON.stringify(matchData, null, 2);
    
    // Create blob for home team if not already processed
    if(!processedTeams.has(match.homeTeam)){
      const homeBlob = await ghPost(`repos/${username}/${repo}/git/blobs`, token, {
        content: jsonContent,
        encoding: 'utf-8'
      });
      tree.push({
        path: `intro/teams/${match.homeTeam}.json`,
        mode: '100644',
        type: 'blob',
        sha: homeBlob.sha
      });
      processedTeams.add(match.homeTeam);
    }
    
    // Create blob for away team if not already processed
    if(!processedTeams.has(match.awayTeam)){
      const awayBlob = await ghPost(`repos/${username}/${repo}/git/blobs`, token, {
        content: jsonContent,
        encoding: 'utf-8'
      });
      tree.push({
        path: `intro/teams/${match.awayTeam}.json`,
        mode: '100644',
        type: 'blob',
        sha: awayBlob.sha
      });
      processedTeams.add(match.awayTeam);
    }
  }
  
  // Create new tree
  const newTree = await ghPost(`repos/${username}/${repo}/git/trees`, token, {
    base_tree: baseTreeSha,
    tree: tree
  });
  
  // Create commit
  const newCommit = await ghPost(`repos/${username}/${repo}/git/commits`, token, {
    message: `Update ${matches.length} match(es) intro data`,
    tree: newTree.sha,
    parents: [latestCommitSha]
  });
  
  // Update branch reference
  await ghPatch(`repos/${username}/${repo}/git/refs/heads/${branch}`, token, {
    sha: newCommit.sha
  });
}

// Preview all matches
$id('previewAll').addEventListener('click', ()=>{
  if(matches.length === 0){
    showStatus('error', 'Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î­Î½Î±Î½ Î±Î³ÏÎ½Î±!');
    return;
  }
  
  matches.forEach((match, i)=>{
    if(!match.homeTeam || !match.awayTeam){
      showStatus('error', `Î‘Î³ÏÎ½Î±Ï‚ ${i+1}: Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î´ÏÎ¿ Î¿Î¼Î¬Î´ÎµÏ‚!`);
      return;
    }
    
    const homeTeam = teams.find(t => t.slug === match.homeTeam);
    const awayTeam = teams.find(t => t.slug === match.awayTeam);
    
    const params = new URLSearchParams({
      homeName: homeTeam.name,
      homeSubtitle: match.homeSubtitle || homeTeam.subtitle,
      awayName: awayTeam.name,
      awaySubtitle: match.awaySubtitle || awayTeam.subtitle,
      date: formatGreekDate(new Date(match.date)),
      league: match.league
    });
    
    window.open(`intro.html?${params.toString()}`, `_blank_${i}`);
  });
});

// GitHub API helpers
async function ghGet(endpoint, token){
  const res = await fetch(`https://api.github.com/${endpoint}`, {
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json'
    }
  });
  if(!res.ok){
    const data = await res.json().catch(()=>({}));
    throw new Error(`${res.status} ${res.statusText} - ${data.message || ''}`);
  }
  return res.json();
}

async function ghPost(endpoint, token, body){
  const res = await fetch(`https://api.github.com/${endpoint}`, {
    method: 'POST',
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body)
  });
  if(!res.ok){
    const data = await res.json().catch(()=>({}));
    throw new Error(`${res.status} ${res.statusText} - ${data.message || ''}`);
  }
  return res.json();
}

async function ghPatch(endpoint, token, body){
  const res = await fetch(`https://api.github.com/${endpoint}`, {
    method: 'PATCH',
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body)
  });
  if(!res.ok){
    const data = await res.json().catch(()=>({}));
    throw new Error(`${res.status} ${res.statusText} - ${data.message || ''}`);
  }
  return res.json();
}

// Format Greek date
function formatGreekDate(date){
  const months = ['Î™Î±Î½Î¿Ï…Î±ÏÎ¯Î¿Ï…','Î¦ÎµÎ²ÏÎ¿Ï…Î±ÏÎ¯Î¿Ï…','ÎœÎ±ÏÏ„Î¯Î¿Ï…','Î‘Ï€ÏÎ¹Î»Î¯Î¿Ï…','ÎœÎ±ÎÎ¿Ï…','Î™Î¿Ï…Î½Î¯Î¿Ï…',
                  'Î™Î¿Ï…Î»Î¯Î¿Ï…','Î‘Ï…Î³Î¿ÏÏƒÏ„Î¿Ï…','Î£ÎµÏ€Ï„ÎµÎ¼Î²ÏÎ¯Î¿Ï…','ÎŸÎºÏ„Ï‰Î²ÏÎ¯Î¿Ï…','ÎÎ¿ÎµÎ¼Î²ÏÎ¯Î¿Ï…','Î”ÎµÎºÎµÎ¼Î²ÏÎ¯Î¿Ï…'];
  return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
}

// Show status message
function showStatus(type, message){
  const statusDiv = $id('status');
  statusDiv.className = `status ${type}`;
  statusDiv.textContent = message;
  setTimeout(()=>{
    if(type !== 'info') statusDiv.className = 'status info';
  }, 8000);
}

// Initialize
loadConfig();
createMatch(0); // Start with one match
</script>
</body>
</html>
